<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1a3a5f">
<meta name="robots" content="noindex,nofollow">
<title>VPM | Project Command Centre</title>
<link rel="icon" href="images/favicon.svg" type="image/svg+xml">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Libre+Baskerville:ital,wght@0,400;0,700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#f0f7ff;--text:#1a2d4a;--text2:#3d5a80;--text3:#5c7a9e;
  --navy:#1a3a5f;--blue:#2563eb;--blue-light:#48c9f5;--blue-dim:rgba(72,201,245,.12);
  --glass:rgba(255,255,255,.75);--glass-border:rgba(255,255,255,.5);
  --green:#059669;--green-dim:rgba(5,150,105,.1);--green-border:rgba(5,150,105,.25);
  --amber:#d97706;--amber-dim:rgba(217,119,6,.1);--amber-border:rgba(217,119,6,.25);
  --red:#dc2626;--red-dim:rgba(220,38,38,.1);--red-border:rgba(220,38,38,.25);
  --font:'DM Sans',system-ui,sans-serif;--font-serif:'Libre Baskerville',serif;
  --radius:16px;--radius-sm:12px;
  --shadow:0 2px 8px rgba(26,58,95,.06);--shadow-glass:0 8px 32px rgba(26,58,95,.08);
  --surface:var(--glass);--surface2:rgba(255,255,255,.5);--border:var(--glass-border);--border-light:rgba(72,201,245,.3);
  --blue-glow:rgba(37,99,235,.25);
}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:linear-gradient(160deg,#f0f7ff 0%,#e8f4fc 40%,#f5f9ff 100%);background-attachment:fixed;color:var(--text);-webkit-font-smoothing:antialiased;min-height:100vh}
a{color:inherit;text-decoration:none}

/* â•â•â• LOGIN (hidden) â•â•â• */
.login{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.login-card{background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:48px;max-width:420px;width:100%;text-align:center;box-shadow:var(--shadow-glass)}
.login-logo{width:200px;margin:0 auto 24px}
.login-card h2{font-size:20px;font-weight:700;margin-bottom:4px;color:var(--navy)}
.login-card .sub{font-size:13px;color:var(--text2);margin-bottom:28px}
.login-input{width:100%;padding:14px 16px;background:rgba(255,255,255,.8);border:1px solid var(--glass-border);border-radius:10px;color:var(--text);font-family:var(--font);font-size:14px;outline:none;margin-bottom:12px;transition:border .2s}
.login-input:focus{border-color:var(--blue)}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--navy),var(--blue));color:#fff;border:none;border-radius:10px;font-family:var(--font);font-size:14px;font-weight:700;cursor:pointer;transition:all .2s}
.login-btn:hover{opacity:.9}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}

/* â•â•â• LAYOUT - Glass morphism â•â•â• */
.app{display:none}
.topbar{background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--glass-border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:var(--shadow)}
.topbar-left{display:flex;align-items:center;gap:12px}
.topbar-logo{height:40px}
.topbar-title{font-size:14px;font-weight:700;letter-spacing:-.3px;color:var(--navy)}
.topbar-sub{font-size:11px;color:var(--text3);letter-spacing:.5px;text-transform:uppercase}
.topbar-right{display:flex;align-items:center;gap:12px}
.topbar-user{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text2)}
.topbar-right a{padding:10px 16px;font-size:14px;font-weight:600;color:var(--text2);text-decoration:none;border-radius:var(--radius-sm);transition:all .2s}
.topbar-right a:hover{color:var(--navy);background:var(--blue-dim)}
.topbar-right a.primary{padding:10px 18px;background:linear-gradient(135deg,var(--navy),var(--blue));color:#fff}
.topbar-right a.primary:hover{opacity:.9}
.topbar-avatar{width:32px;height:32px;background:var(--blue-dim);border:1px solid rgba(37,99,235,.2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--blue)}
.main{max-width:1200px;margin:0 auto;padding:24px}

/* â•â•â• BREADCRUMB â•â•â• */
.breadcrumb{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text3);margin-bottom:20px}
.breadcrumb a{color:var(--text2);transition:color .2s;cursor:pointer}
.breadcrumb a:hover{color:var(--blue)}
.breadcrumb span{color:var(--text)}
.bc-sep{font-size:10px}

/* â•â•â• STATS - Glass â•â•â• */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.stat-card{background:var(--glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
.stat-card:hover{box-shadow:var(--shadow-glass)}
.stat-label{font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:var(--text3);margin-bottom:8px;font-weight:600}
.stat-value{font-size:28px;font-weight:900;letter-spacing:-1px;line-height:1;color:var(--navy)}
.stat-change{font-size:11px;margin-top:6px;color:var(--text3)}
.stat-up{color:var(--green)}
.stat-down{color:var(--red)}
@media(max-width:768px){.stats-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:480px){.stats-grid{grid-template-columns:1fr}}

/* â•â•â• SECTION HEADERS â•â•â• */
.section-head{display:flex;justify-content:space-between;align-items:center;margin:28px 0 14px}
.section-title{font-size:18px;font-weight:800;letter-spacing:-.5px;color:var(--navy)}

/* â•â•â• JOB CARDS - Glass â•â•â• */
.jobs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px}
.job-card{background:var(--glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;cursor:pointer;transition:all .25s;box-shadow:var(--shadow)}
.job-card:hover{border-color:rgba(72,201,245,.4);transform:translateY(-2px);box-shadow:var(--shadow-glass)}
.job-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.job-name{font-size:15px;font-weight:700;letter-spacing:-.3px;color:var(--text)}
.job-client{font-size:12px;color:var(--text2);margin-top:2px}
.job-status{font-size:9px;padding:4px 10px;border-radius:6px;letter-spacing:.5px;font-weight:600;white-space:nowrap}
.status-active{background:var(--green-dim);color:var(--green);border:1px solid var(--green-border)}
.status-review{background:var(--amber-dim);color:var(--amber);border:1px solid var(--amber-border)}
.status-risk{background:var(--red-dim);color:var(--red);border:1px solid var(--red-border)}
.status-complete{background:var(--blue-dim);color:var(--navy);border:1px solid rgba(72,201,245,.3)}

/* â•â•â• PROGRESS BAR â•â•â• */
.progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.progress-label{font-size:11px;color:var(--text3)}
.progress-pct{font-size:11px;font-weight:600;color:var(--text2)}
.progress-track{height:6px;background:rgba(255,255,255,.6);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.fill-green{background:linear-gradient(90deg,#059669,#10b981)}
.fill-amber{background:linear-gradient(90deg,#d97706,#f59e0b)}
.fill-red{background:linear-gradient(90deg,#dc2626,#ef4444)}
.fill-blue{background:linear-gradient(90deg,#2563eb,#48c9f5)}

/* â•â•â• JOB META â•â•â• */
.job-checklists{display:flex;flex-wrap:wrap;gap:6px;margin-top:12px}
.cl-tag{font-size:9px;padding:4px 8px;border-radius:4px;letter-spacing:.3px;display:flex;align-items:center;gap:4px}
.cl-done{background:var(--green-dim);color:var(--green);border:1px solid var(--green-border)}
.cl-pending{background:rgba(255,255,255,.5);color:var(--text3);border:1px solid var(--glass-border)}
.cl-overdue{background:var(--red-dim);color:var(--red);border:1px solid var(--red-border)}
.job-meta{display:flex;gap:16px;margin-top:12px;padding-top:12px;border-top:1px solid var(--glass-border)}
.meta-item{font-size:10px;color:var(--text3);display:flex;align-items:center;gap:4px}

/* â•â•â• ALERTS - Glass â•â•â• */
.alert-list{display:flex;flex-direction:column;gap:8px;margin-bottom:24px}
.alert{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius-sm);transition:all .2s;box-shadow:var(--shadow)}
.alert:hover{background:rgba(255,255,255,.9);box-shadow:var(--shadow-glass)}
.alert-icon{font-size:18px;flex-shrink:0}
.alert-text{font-size:13px;flex:1;color:var(--text)}
.alert-text strong{font-weight:600}
.alert-time{font-size:10px;color:var(--text3);white-space:nowrap}
.alert-urgent{border-left:4px solid var(--red)}
.alert-warning{border-left:4px solid var(--amber)}
.alert-info{border-left:4px solid var(--blue)}

/* â•â•â• TABS - Glass â•â•â• */
.tabs{display:flex;gap:6px;background:rgba(255,255,255,.5);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:6px;margin-bottom:20px}
.tab{flex:1;padding:10px 16px;text-align:center;font-size:12px;font-weight:600;border-radius:var(--radius-sm);cursor:pointer;transition:all .2s;color:var(--text2)}
.tab.active{background:var(--glass);color:var(--navy);box-shadow:var(--shadow);border:1px solid var(--glass-border)}
.tab:hover:not(.active){color:var(--navy);background:var(--blue-dim)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JOB DETAIL VIEW (NEW)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.job-detail{display:none}

/* Hero header */
.jd-hero{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:28px;margin-bottom:20px;position:relative;overflow:hidden}
.jd-hero::before{content:'';position:absolute;top:0;right:0;width:300px;height:100%;background:linear-gradient(135deg,transparent 40%,var(--blue-dim));pointer-events:none}
.jd-hero-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;position:relative}
.jd-name{font-size:clamp(20px,3vw,28px);font-weight:900;letter-spacing:-1px;line-height:1.1}
.jd-client{font-size:14px;color:var(--text2);margin-top:4px}
.jd-hero-meta{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;position:relative}
.jd-meta-item{text-align:center;padding:12px;background:rgba(255,255,255,.6);backdrop-filter:blur(8px);border-radius:10px;border:1px solid var(--glass-border)}
.jd-meta-label{font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:4px;font-weight:600}
.jd-meta-value{font-size:16px;font-weight:800;letter-spacing:-.3px;color:var(--navy)}
@media(max-width:600px){.jd-hero-meta{grid-template-columns:repeat(2,1fr)}}

/* Overall progress ring area */
.jd-progress-section{display:grid;grid-template-columns:160px 1fr;gap:24px;margin-bottom:20px;align-items:center;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px}
.jd-ring-wrap{display:flex;align-items:center;justify-content:center}
.jd-ring{position:relative;width:120px;height:120px}
.jd-ring svg{transform:rotate(-90deg)}
.jd-ring-bg{fill:none;stroke:rgba(255,255,255,.5);stroke-width:8}
.jd-ring-fill{fill:none;stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset .8s cubic-bezier(.4,0,.2,1)}
.jd-ring-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.jd-ring-pct{font-size:28px;font-weight:900;letter-spacing:-1px}
.jd-ring-label{font-family:var(--mono);font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--text3)}
.jd-phase-list{display:flex;flex-direction:column;gap:8px}
.jd-phase{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--surface2);border-radius:8px;border:1px solid transparent;transition:all .2s}
.jd-phase.current{border-color:var(--blue);background:var(--blue-dim)}
.jd-phase-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.jd-phase-dot.done{background:var(--green)}
.jd-phase-dot.active{background:var(--blue);box-shadow:0 0 8px var(--blue-glow);animation:pulse-dot 2s infinite}
.jd-phase-dot.pending{background:rgba(255,255,255,.8);border:2px solid var(--glass-border)}
@keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.5}}
.jd-phase-name{font-size:13px;font-weight:600;flex:1}
.jd-phase-pct{font-family:var(--mono);font-size:11px;color:var(--text3);font-weight:700}
@media(max-width:600px){.jd-progress-section{grid-template-columns:1fr}.jd-ring-wrap{margin-bottom:8px}}

/* Checklist cards grid */
.cl-cards-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
@media(max-width:700px){.cl-cards-grid{grid-template-columns:1fr}}
.cl-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
.cl-card:hover{border-color:rgba(72,201,245,.4);transform:translateY(-2px);box-shadow:var(--shadow-glass)}
.cl-card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
.cl-card-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
.cl-card-icon.cra{background:var(--red-dim);border:1px solid var(--red-border)}
.cl-card-icon.wdc{background:var(--blue-dim);border:1px solid rgba(72,201,245,.3)}
.cl-card-icon.itp{background:var(--amber-dim);border:1px solid var(--amber-border)}
.cl-card-icon.qa{background:var(--green-dim);border:1px solid var(--green-border)}
.cl-card-status{font-family:var(--mono);font-size:9px;padding:4px 10px;border-radius:6px;letter-spacing:.5px;font-weight:600}
.cl-card-name{font-size:15px;font-weight:700;letter-spacing:-.3px;margin-bottom:2px}
.cl-card-count{font-family:var(--mono);font-size:11px;color:var(--text3)}
.cl-card-progress{margin:16px 0 12px}
.cl-card-sections{display:flex;flex-wrap:wrap;gap:4px}
.cl-sec-tag{font-size:8px;padding:3px 7px;border-radius:4px;background:var(--surface2);color:var(--text3);letter-spacing:.3px;border:1px solid var(--glass-border)}
.cl-sec-tag.done{background:var(--green-dim);color:var(--green);border-color:var(--green-border)}
.cl-card-arrow{position:absolute;bottom:18px;right:18px;font-size:18px;color:var(--text3);transition:all .25s}
.cl-card:hover .cl-card-arrow{color:var(--blue);transform:translateX(4px)}

/* Activity / timeline */
.jd-activity{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:20px}
.jd-activity-title{font-size:14px;font-weight:700;margin-bottom:16px}
.activity-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)}
.activity-item:last-child{border:none}
.activity-dot{width:8px;height:8px;border-radius:50%;margin-top:5px;flex-shrink:0}
.activity-content{flex:1}
.activity-text{font-size:13px;line-height:1.5}
.activity-time{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:2px}

/* Notes */
.jd-notes{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;margin-bottom:20px}
.jd-notes-title{font-size:14px;font-weight:700;margin-bottom:12px}
.jd-note-input{width:100%;padding:12px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:var(--font);font-size:13px;outline:none;resize:none;min-height:60px;transition:border .2s}
.jd-note-input:focus{border-color:var(--blue)}
.jd-note-btn{padding:8px 20px;background:var(--blue);color:#fff;border:none;border-radius:8px;font-family:var(--font);font-size:12px;font-weight:700;cursor:pointer;margin-top:8px;transition:all .2s}
.jd-note-btn:hover{background:var(--blue-light)}
.note-item{padding:10px 0;border-bottom:1px solid var(--border);font-size:13px;line-height:1.5}
.note-item:last-child{border:none}
.note-meta{font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKLIST DETAIL VIEW (IMPROVED)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.checklist-view{display:none}

/* Sticky checklist header */
.cl-sticky{position:sticky;top:69px;z-index:50;background:linear-gradient(180deg,var(--bg) 0%,transparent 100%);padding:16px 0 12px;margin-bottom:8px}
.cl-head-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cl-head-left{display:flex;align-items:center;gap:12px}
.cl-head-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.cl-head-title{font-size:18px;font-weight:800;letter-spacing:-.5px}
.cl-head-sub{font-family:var(--mono);font-size:11px;color:var(--text3)}
.cl-head-stats{display:flex;gap:16px;align-items:center}
.cl-head-stat{text-align:center}
.cl-head-stat-val{font-size:16px;font-weight:800}
.cl-head-stat-label{font-family:var(--mono);font-size:8px;letter-spacing:.5px;text-transform:uppercase;color:var(--text3)}
.cl-big-progress{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
.cl-big-progress .progress-fill{height:100%;border-radius:4px}

/* Section accordion */
.cl-section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:10px;overflow:hidden;transition:border-color .2s}
.cl-section:hover{border-color:var(--border-light)}
.cl-section-header{display:flex;align-items:center;gap:12px;padding:16px 20px;cursor:pointer;transition:background .15s;user-select:none}
.cl-section-header:hover{background:var(--surface2)}
.cl-section-chevron{font-size:14px;color:var(--text3);transition:transform .25s;flex-shrink:0}
.cl-section.open .cl-section-chevron{transform:rotate(90deg)}
.cl-section-name{font-size:14px;font-weight:700;flex:1}
.cl-section-progress{display:flex;align-items:center;gap:10px;flex-shrink:0}
.cl-section-bar{width:80px;height:4px;background:var(--surface2);border-radius:2px;overflow:hidden}
.cl-section-bar-fill{height:100%;border-radius:2px;transition:width .4s}
.cl-section-pct{font-family:var(--mono);font-size:11px;font-weight:700;min-width:32px;text-align:right}
.cl-section-body{display:none;padding:0 20px 16px}
.cl-section.open .cl-section-body{display:block}

/* Checklist items (improved) */
.cli{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:8px;cursor:pointer;transition:all .15s;margin-bottom:4px;border:1px solid transparent}
.cli:hover{background:var(--surface2);border-color:var(--border)}
.cli-check{width:20px;height:20px;border:2px solid var(--border-light);border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s}
.cli.done .cli-check{background:var(--green);border-color:var(--green)}
.cli.done .cli-check::after{content:'âœ“';color:#fff;font-size:11px;font-weight:700}
.cli.done .cli-text{color:var(--text3);text-decoration:line-through}
.cli-text{font-size:13px;flex:1;line-height:1.4}
.cli-num{font-family:var(--mono);font-size:9px;color:var(--text3);min-width:20px;flex-shrink:0}
.cli-risk{font-family:var(--mono);font-size:9px;padding:3px 8px;border-radius:4px;font-weight:600;flex-shrink:0}

/* â•â•â• FAB â•â•â• */
.fab{position:fixed;bottom:24px;right:24px;width:56px;height:56px;background:linear-gradient(135deg,var(--navy),var(--blue));border:none;border-radius:50%;color:#fff;font-size:28px;cursor:pointer;z-index:90;box-shadow:0 6px 24px rgba(26,58,95,.35);display:flex;align-items:center;justify-content:center;transition:all .2s}
.fab:hover{transform:scale(1.08);box-shadow:0 8px 32px rgba(26,58,95,.4)}

/* â•â•â• MODAL â•â•â• */
.modal-overlay{position:fixed;inset:0;background:rgba(26,58,95,.4);backdrop-filter:blur(4px);z-index:200;display:none;align-items:center;justify-content:center;padding:24px}
.modal-overlay.open{display:flex}
.modal{background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:16px;padding:32px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow-glass)}
.modal h3{font-size:18px;font-weight:800;margin-bottom:16px;color:var(--navy)}
.modal .field{margin-bottom:16px}
.modal .field label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:6px}
.modal .field input,.modal .field select,.modal .field textarea{width:100%;padding:12px 14px;background:rgba(255,255,255,.8);border:1px solid var(--glass-border);border-radius:8px;color:var(--text);font-family:var(--font);font-size:13px;outline:none;transition:border .2s}
.modal .field input:focus,.modal .field select:focus,.modal .field textarea:focus{border-color:var(--blue)}
.modal-actions{display:flex;gap:8px;margin-top:20px}
.modal-btn{flex:1;padding:12px;border:none;border-radius:8px;font-family:var(--font);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s}
.modal-btn.primary{background:linear-gradient(135deg,var(--navy),var(--blue));color:#fff}
.modal-btn.ghost{background:rgba(255,255,255,.6);color:var(--text2);border:1px solid var(--glass-border)}

.simpro-synced{display:inline-flex;align-items:center;gap:10px;padding:8px 16px;background:linear-gradient(135deg,#059669,#10b981);color:#fff;font-size:13px;font-weight:600;border-radius:var(--radius-sm);box-shadow:0 2px 12px rgba(5,150,105,.3);animation:simproPulse 1.5s ease-in-out infinite}
.simpro-synced img{height:18px;width:auto;filter:brightness(0) invert(1);object-fit:contain}
@keyframes simproPulse{0%,100%{box-shadow:0 2px 12px rgba(5,150,105,.3)}50%{box-shadow:0 2px 16px rgba(5,150,105,.5),0 0 12px rgba(5,150,105,.2)}}

@media(max-width:640px){.jobs-grid{grid-template-columns:1fr}.tabs{flex-wrap:wrap}.cl-head-stats{display:none}.simpro-synced{font-size:12px;padding:6px 12px}.simpro-synced img{height:14px}}
</style>
</head>
<body>

<!-- LOGIN - DISABLED -->
<div class="login" id="login" style="display:none">
  <div class="login-card">
    <img src="images/victorian-projects-logo.png" class="login-logo" alt="Victorian Projects Mechanical Services">
    <h2>Project Command Centre</h2>
    <div class="sub">Sign in to manage your jobs and checklists</div>
    <input type="text" class="login-input" id="login-user" placeholder="Username" value="admin">
    <input type="password" class="login-input" id="login-pass" placeholder="Password">
    <button class="login-btn" onclick="doLogin()">Sign In</button>
    <div class="login-error" id="login-error">Invalid credentials</div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app" style="display:block">
  <div class="topbar">
    <div class="topbar-left">
      <a href="index.html"><img src="images/victorian-projects-logo.png" class="topbar-logo" alt="Victorian Projects"></a>
      <div><div class="topbar-title">Project Command Centre</div><div class="topbar-sub">Victorian Projects Mechanical</div></div>
    </div>
    <div class="topbar-right">
      <a href="cra.html" class="primary">CRA Review â†’</a>
      <div class="simpro-synced" title="Connected to Simpro">
        <img src="images/simpro-logo.png" alt="Simpro">
        <span>Simpro synced</span>
      </div>
      <div class="topbar-user">
        <div class="topbar-avatar">AD</div>
        <span>Admin</span>
      </div>
    </div>
  </div>

  <div class="main">
    <!-- â•â•â• DASHBOARD â•â•â• -->
    <div id="view-dashboard">
      <div class="section-head"><div class="section-title">âš¡ Needs Attention</div></div>
      <div class="alert-list">
        <div class="alert alert-urgent"><div class="alert-icon">ğŸ”´</div><div class="alert-text"><strong>Workshop Drawing Checklist</strong> overdue on <strong>Mernda Aged Care</strong> - was due 3 days ago</div><div class="alert-time">3d overdue</div></div>
        <div class="alert alert-warning"><div class="alert-icon">ğŸŸ¡</div><div class="alert-text"><strong>ITP Site Inspection</strong> due tomorrow on <strong>Richmond Hotel Fitout</strong></div><div class="alert-time">Due tomorrow</div></div>
        <div class="alert alert-info"><div class="alert-icon">ğŸ”µ</div><div class="alert-text"><strong>Contract Risk Assessment</strong> submitted for review on <strong>Geelong Hospital Wing B</strong></div><div class="alert-time">2h ago</div></div>
      </div>

      <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">Active Jobs</div><div class="stat-value">7</div><div class="stat-change stat-up">â†‘ 2 this month</div></div>
        <div class="stat-card"><div class="stat-label">Checklists Due</div><div class="stat-value" style="color:var(--amber)">4</div><div class="stat-change stat-down">2 overdue</div></div>
        <div class="stat-card"><div class="stat-label">Avg Completion</div><div class="stat-value">72%</div><div class="stat-change stat-up">â†‘ 8% vs last month</div></div>
        <div class="stat-card"><div class="stat-label">Risk Score</div><div class="stat-value" style="color:var(--green)">LOW</div><div class="stat-change stat-up">All assessments current</div></div>
      </div>

      <div class="tabs" id="dash-tabs">
        <div class="tab active" onclick="showTab('active',this)">Active Jobs</div>
        <div class="tab" onclick="showTab('review',this)">Needs Review</div>
        <div class="tab" onclick="showTab('completed',this)">Completed</div>
      </div>
      <div class="jobs-grid" id="jobs-grid"></div>
    </div>

    <!-- â•â•â• JOB DETAIL â•â•â• -->
    <div class="job-detail" id="view-job"></div>

    <!-- â•â•â• CHECKLIST DETAIL â•â•â• -->
    <div class="checklist-view" id="view-checklist"></div>
  </div>

  <button class="fab" id="fab" onclick="openNewJob()">+</button>
</div>

<!-- NEW JOB MODAL -->
<div class="modal-overlay" id="modal-new-job">
  <div class="modal">
    <h3>Create New Job</h3>
    <div class="field"><label>Job Name</label><input type="text" id="new-job-name" placeholder="e.g. Mernda Aged Care - Mechanical"></div>
    <div class="field"><label>Client / Builder</label><input type="text" id="new-job-client" placeholder="e.g. Probuild"></div>
    <div class="field"><label>Project Manager</label><select id="new-job-pm"><option>Select PM...</option><option>Josh Thompson</option><option>Mark Sullivan</option><option>Dan Kelly</option></select></div>
    <div class="field"><label>Estimated Value</label><input type="text" id="new-job-value" placeholder="e.g. $450,000"></div>
    <div class="field"><label>Start Date</label><input type="date" id="new-job-date"></div>
    <div class="modal-actions">
      <button class="modal-btn ghost" onclick="closeModal('modal-new-job')">Cancel</button>
      <button class="modal-btn primary" onclick="createJob()">Create Job</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const JOBS = [
  { id:1, name:'Mernda Aged Care', client:'Probuild', pm:'Josh Thompson', value:'$680,000', status:'active', start:'2025-11-12', completion:45,
    checklists:{ cra:{done:60,total:60}, wdc:{done:42,total:120,overdue:true}, itp:{done:0,total:85}, qa:{done:0,total:65} },
    notes:['Awaiting revised mechanical spec from architect','Builder requesting earlier completion - discuss at next site meeting'],
    activity:[
      {text:'Workshop Drawing Checklist became overdue',dot:'var(--red)',time:'3 days ago'},
      {text:'Josh completed Contract Risk Assessment (60/60)',dot:'var(--green)',time:'1 week ago'},
      {text:'Ductwork submittal approved by Probuild',dot:'var(--blue)',time:'2 weeks ago'},
      {text:'Job created and assigned to Josh Thompson',dot:'var(--text3)',time:'Nov 12, 2025'}
    ]
  },
  { id:2, name:'Richmond Hotel Fitout', client:'Built', pm:'Mark Sullivan', value:'$320,000', status:'active', start:'2025-10-05', completion:72,
    checklists:{ cra:{done:60,total:60}, wdc:{done:120,total:120}, itp:{done:55,total:85,due:'tomorrow'}, qa:{done:0,total:65} },
    notes:['Chiller delivery delayed by 2 weeks - adjust program'],
    activity:[
      {text:'ITP Site Inspection due tomorrow',dot:'var(--amber)',time:'Today'},
      {text:'Workshop Drawings fully completed (120/120)',dot:'var(--green)',time:'2 days ago'},
      {text:'Mark updated site inspection schedule',dot:'var(--blue)',time:'4 days ago'}
    ]
  },
  { id:3, name:'Geelong Hospital Wing B', client:'Lendlease', pm:'Josh Thompson', value:'$1,200,000', status:'review', start:'2026-01-20', completion:15,
    checklists:{ cra:{done:48,total:60,review:true}, wdc:{done:0,total:120}, itp:{done:0,total:85}, qa:{done:0,total:65} },
    notes:['High-value job. Lendlease have strict documentation requirements','Need to confirm sub-contractor availability before committing to program'],
    activity:[
      {text:'Contract Risk Assessment submitted for review (48/60)',dot:'var(--amber)',time:'2 hours ago'},
      {text:'Job created - awaiting contract finalisation',dot:'var(--text3)',time:'Jan 20, 2026'}
    ]
  },
  { id:4, name:'Docklands Tower 3 - Lvl 8-12', client:'Multiplex', pm:'Dan Kelly', value:'$890,000', status:'active', start:'2025-08-15', completion:88,
    checklists:{ cra:{done:60,total:60}, wdc:{done:120,total:120}, itp:{done:78,total:85}, qa:{done:45,total:65} },
    notes:['Practical completion target: March 15, 2026'],
    activity:[
      {text:'QA Check progressing well (45/65)',dot:'var(--green)',time:'Yesterday'},
      {text:'ITP nearing completion (78/85)',dot:'var(--blue)',time:'3 days ago'},
      {text:'Dan flagged minor defect in Level 10 pipework',dot:'var(--amber)',time:'1 week ago'}
    ]
  },
  { id:5, name:'Bendigo TAFE Upgrade', client:'Kane Constructions', pm:'Mark Sullivan', value:'$210,000', status:'active', start:'2025-12-01', completion:30,
    checklists:{ cra:{done:60,total:60}, wdc:{done:36,total:120}, itp:{done:0,total:85}, qa:{done:0,total:65} },
    notes:['Regional job. Travel costs factored into estimate.'],
    activity:[
      {text:'Workshop Drawings 30% complete (36/120)',dot:'var(--blue)',time:'2 days ago'},
      {text:'Contract Risk Assessment completed',dot:'var(--green)',time:'Dec 8, 2025'}
    ]
  },
  { id:6, name:'Airport West Industrial', client:'Vaughan Constructions', pm:'Josh Thompson', value:'$450,000', status:'complete', start:'2025-05-20', completion:100,
    checklists:{ cra:{done:60,total:60}, wdc:{done:120,total:120}, itp:{done:85,total:85}, qa:{done:65,total:65} },
    notes:['Job complete. All documentation submitted. Defects liability period ends May 2026.'],
    activity:[
      {text:'All checklists completed. Job marked as complete.',dot:'var(--green)',time:'Feb 10, 2026'},
      {text:'Client sign-off received',dot:'var(--green)',time:'Feb 8, 2026'}
    ]
  },
  { id:7, name:'Ballarat Base Hospital', client:'CPB Contractors', pm:'Dan Kelly', value:'$1,500,000', status:'active', start:'2026-02-01', completion:8,
    checklists:{ cra:{done:12,total:60}, wdc:{done:0,total:120}, itp:{done:0,total:85}, qa:{done:0,total:65} },
    notes:['Largest job on the books. CPB have strict safety requirements.','Insurance reviewed and confirmed adequate.'],
    activity:[
      {text:'Contract Risk Assessment started (12/60)',dot:'var(--amber)',time:'3 days ago'},
      {text:'Job created and assigned to Dan Kelly',dot:'var(--text3)',time:'Feb 1, 2026'}
    ]
  }
];

const CL_META = {
  cra: { name:'Contract Risk Assessment', short:'CRA', icon:'âš ï¸', iconCls:'cra', desc:'Risk evaluation of contract terms, financials, and compliance' },
  wdc: { name:'Workshop Drawing Checklist', short:'WDC', icon:'ğŸ“', iconCls:'wdc', desc:'Verification of all workshop and coordination drawings' },
  itp: { name:'Inspection & Test Plan', short:'ITP', icon:'ğŸ”', iconCls:'itp', desc:'Staged inspection and testing through construction lifecycle' },
  qa:  { name:'Quality Assurance Check', short:'QA', icon:'âœ…', iconCls:'qa', desc:'Workmanship, compliance, testing and handover quality' }
};

const CL_TEMPLATES = {
  cra: { sections:[
    { title:'Contract Terms', items:['Contract value confirmed and matches estimate','Payment terms reviewed (progress claims, retentions)','Liquidated damages clause reviewed','Defects liability period confirmed','Warranty obligations reviewed','Insurance requirements met','Security of payment terms confirmed','Subcontractor warranty obligations noted','Dispute resolution process reviewed','Contract execution deadline confirmed'] },
    { title:'Financial Risk', items:['Profit margin minimum 12% confirmed','Material cost escalation clause included','Variation process clearly defined','Retention terms acceptable','Credit check on builder completed','Payment history with builder reviewed','Bond/guarantee requirements reviewed','Cash flow forecast completed','Progress claim schedule confirmed','Final account process reviewed'] },
    { title:'Scope & Technical', items:['Scope of works clearly defined','Mechanical specifications reviewed','Hydraulic specifications reviewed','Fire services scope confirmed','BCA compliance requirements identified','Energy efficiency requirements noted','Commissioning requirements defined','As-built drawing requirements noted','Design responsibility clearly allocated','Interface with other trades identified'] },
    { title:'Program & Resources', items:['Construction program reviewed','Lead times for major equipment checked','Labour availability confirmed','Subcontractor availability confirmed','Site access and logistics reviewed','Crane/equipment access confirmed','Storage facilities available','After-hours work requirements noted','Milestone dates achievable','Float/contingency in program'] },
    { title:'Site & Safety', items:['Site conditions inspected','Hazardous materials identified','Working at heights requirements','Confined space requirements','Hot works requirements','Existing services identified','Environmental requirements noted','Noise restrictions identified','Heritage/sensitive areas noted','Emergency procedures reviewed'] },
    { title:'Approvals & Compliance', items:['Building permit requirements','Council approvals required','Authority inspections required','AS/NZS standards compliance confirmed','Green Star/NABERS requirements','Fire engineering requirements','Acoustic requirements','Disability access requirements','Essential safety measures','Occupancy permit requirements'] }
  ]},
  wdc: { sections:[
    { title:'General Arrangement', items:['Floor plan layout matches architectural drawings','Ceiling plan coordinated with other services','Section drawings provided where required','Equipment schedule matches specification','Legend and abbreviations complete','Drawing title block information correct','Revision history updated','Scale appropriate for detail level','North point indicated','Grid references match architectural'] },
    { title:'Ductwork', items:['Supply air duct routing confirmed','Return air duct routing confirmed','Exhaust duct routing confirmed','Outside air duct routing confirmed','Duct sizes match design calculations','Flexible duct connections shown','Fire damper locations marked','Volume control damper locations shown','Access doors for maintenance','Duct support details provided','Insulation requirements noted','Acoustic lining requirements shown','Kitchen exhaust duct material specified','Smoke exhaust duct details','Duct penetration details shown','Condensate drainage from ducts','Expansion joints in ductwork','Duct material specifications noted','Joining methods specified','Duct pressure class noted'] },
    { title:'Pipework', items:['Chilled water pipe routing confirmed','Hot water pipe routing confirmed','Condenser water pipe routing confirmed','Refrigerant pipe routing confirmed','Gas pipe routing confirmed','Pipe sizes match calculations','Pipe support details provided','Valve locations and types shown','Strainer locations shown','Flexible connections shown','Pipe insulation requirements noted','Pipe penetration details','Expansion loops/joints shown','Pressure test points indicated','Drain points shown','Air vent locations marked','Isolation valve locations','Non-return valve locations','Pipe gradient for drainage','Pipe material specifications'] },
    { title:'Equipment', items:['AHU locations and clearances confirmed','Chiller location and access confirmed','Cooling tower location confirmed','Boiler location confirmed','Pump locations and access confirmed','FCU locations confirmed','VAV box locations confirmed','Split system locations confirmed','BMS controller locations','Electrical switchboard locations','Equipment weight on structure confirmed','Vibration isolation details','Equipment access for replacement','Service clearances maintained','Acoustic enclosure requirements','Equipment identification labels','Condensate pump locations','PRV locations confirmed','Heat exchanger locations','VSD locations confirmed'] },
    { title:'Hydraulic', items:['Sanitary drainage routing confirmed','Stormwater routing confirmed','Domestic water pipe routing confirmed','TMV locations confirmed','Hot water plant location confirmed','Backflow prevention devices shown','Disconnector/air gap details','Floor waste locations confirmed','Overflow provisions shown','Grease trap details (if required)','Sewer vent locations','Fire hydrant/hose reel connections','Sprinkler main routing confirmed','Gas meter location confirmed','Gas pipe material and routing','Water meter location','Pressure reduction requirements','Solar hot water (if applicable)','Rainwater tank connection (if applicable)','Thermostatic mixing details'] },
    { title:'Controls & Electrical', items:['BMS point schedule complete','Control valve schedule complete','Sensor locations shown','Thermostat locations confirmed','Control panel locations','Power supply requirements noted','Electrical connection details','Cable tray routing coordinated','Conduit routing shown','Emergency power requirements','Lighting for plant rooms','GPO locations in plant rooms','Switchboard modifications noted','VSD programming requirements','Fire mode operation noted','After-hours operation requirements','Energy metering requirements','Network connection requirements','Alarm/fault indication','Commissioning access points'] }
  ]},
  itp: { sections:[
    { title:'Pre-Installation', items:['Materials delivered match specifications','Equipment serial numbers recorded','Storage conditions appropriate','Damage inspection completed','Certificates of conformance received','Test certificates reviewed','Submittal approvals received','RFI responses received','Hold point notifications issued','Coordination drawings approved','Material safety data sheets available','Warranty documentation received','Installation methodology approved','Quality plan approved','Safety plan approved'] },
    { title:'Rough-In Stage', items:['Pipe penetrations sealed and fire-rated','Duct penetrations sealed and fire-rated','Supports installed as per engineering','Pipe pressure test completed','Duct pressure test completed','Insulation installed correctly','Valve tags installed','Equipment pads/bases level','Condensate drains tested','Floor wastes tested and flowing','Acoustic treatment installed','Access panels installed','Electrical rough-in coordinated','Control wiring installed','Sleeve installations confirmed'] },
    { title:'Fit-Off Stage', items:['Grilles and diffusers installed','Fixtures and fittings installed','Controls and sensors installed','Equipment connected and operational','Balancing dampers accessible','Isolation valves operational','Safety devices tested','Labels and signage installed','Touch-up painting complete','Clean and free of debris','Access maintained for maintenance','Ceiling coordination complete','As-built drawings updated','Test and balance commenced','BMS graphics complete'] },
    { title:'Commissioning', items:['Air balance report complete','Water balance report complete','Controls sequences verified','Safety interlocks tested','Fire mode operation tested','Emergency power changeover tested','Noise levels within specification','Vibration levels acceptable','Energy metering operational','Trend logging operational','Spare parts delivered','O&M manuals submitted','Training provided to building manager','Practical completion items listed','Defect list compiled'] },
    { title:'Documentation', items:['As-built drawings complete','O&M manuals accepted','Test certificates compiled','Warranty certificates compiled','Training records signed','Compliance certificates issued','Authority approvals obtained','Essential safety measures listed','Maintenance schedules provided','Energy compliance documentation','Green Star documentation (if required)','BCA compliance certificate','Occupancy permit documentation','Final account submitted','Project close-out checklist'] }
  ]},
  qa: { sections:[
    { title:'Workmanship', items:['Pipework installed neatly and to trade standard','Ductwork joints sealed correctly','Equipment mounted level and plumb','Support spacing within specification','Insulation applied neatly without gaps','Lagging on valves and fittings complete','No visible damage to equipment','Labels readable and positioned correctly','Access maintained to all service points','General site cleanliness maintained'] },
    { title:'Compliance', items:['Installation matches approved drawings','Material specifications met','Safety devices correctly rated','Fire rating maintained at penetrations','Acoustic requirements met','Electrical connections certified','Gas installations certified','Plumbing installations certified','BCA requirements satisfied','Essential safety measures operational'] },
    { title:'Testing', items:['Pressure tests passed and recorded','Flow rates within design parameters','Temperature differentials correct','Noise measurements within limits','Vibration measurements within limits','Control sequences operating correctly','Safety interlocks functional','Emergency systems tested','Balancing within tolerance','Commissioning data recorded'] },
    { title:'Documentation', items:['ITPs signed off at all stages','Test records filed and accessible','Non-conformance reports closed out','Variation works documented','RFI responses filed','Photo documentation complete','Daily site diaries maintained','Tool box talks recorded','Incident reports filed','Progress claims documentation complete'] },
    { title:'Handover', items:['Defect list items addressed','Client walk-through completed','O&M manuals handed over','Training sessions completed','Spare parts inventory confirmed','Warranty start dates confirmed','As-built accuracy verified','Maintenance access confirmed','Emergency procedures documented','Client satisfaction confirmed'] }
  ]}
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentView = 'dashboard';
let currentJob = null;
let currentCL = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin() {
  if (document.getElementById('login-pass').value === 'vpm2026') {
    document.getElementById('login').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    navigate('dashboard');
  } else {
    document.getElementById('login-error').style.display = 'block';
  }
}
document.getElementById('login-pass').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function navigate(view, data) {
  document.getElementById('view-dashboard').style.display = 'none';
  document.getElementById('view-job').style.display = 'none';
  document.getElementById('view-checklist').style.display = 'none';
  document.getElementById('fab').style.display = 'none';
  currentView = view;

  if (view === 'dashboard') {
    document.getElementById('view-dashboard').style.display = 'block';
    document.getElementById('fab').style.display = 'flex';
    renderJobs('active');
  } else if (view === 'job') {
    currentJob = JOBS.find(j => j.id === data);
    document.getElementById('view-job').style.display = 'block';
    renderJobDetail();
  } else if (view === 'checklist') {
    currentCL = data;
    document.getElementById('view-checklist').style.display = 'block';
    renderChecklist();
  }
  window.scrollTo(0, 0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(filter, tabEl) {
  document.querySelectorAll('#dash-tabs .tab').forEach(t => t.classList.remove('active'));
  tabEl.classList.add('active');
  renderJobs(filter);
}

function renderJobs(filter) {
  const grid = document.getElementById('jobs-grid');
  const filtered = filter === 'active' ? JOBS.filter(j => j.status === 'active') :
                   filter === 'review' ? JOBS.filter(j => j.status === 'review') :
                   JOBS.filter(j => j.status === 'complete');

  grid.innerHTML = filtered.map(j => {
    const sc = j.status === 'active' ? 'status-active' : j.status === 'review' ? 'status-review' : 'status-complete';
    const st = j.status === 'active' ? 'ACTIVE' : j.status === 'review' ? 'NEEDS REVIEW' : 'COMPLETE';
    const fc = j.completion > 75 ? 'fill-green' : j.completion > 40 ? 'fill-blue' : j.completion > 20 ? 'fill-amber' : 'fill-red';
    const tags = Object.entries(j.checklists).map(([k,c]) => {
      const p = Math.round((c.done/c.total)*100);
      const cls = c.overdue ? 'cl-overdue' : p===100 ? 'cl-done' : 'cl-pending';
      return `<span class="cl-tag ${cls}">${c.overdue?'âš ':p===100?'âœ“':''} ${CL_META[k].short} ${p}%</span>`;
    }).join('');
    return `<div class="job-card" onclick="navigate('job',${j.id})">
      <div class="job-top"><div><div class="job-name">${j.name}</div><div class="job-client">${j.client}</div></div><span class="job-status ${sc}">${st}</span></div>
      <div style="margin:12px 0"><div class="progress-header"><span class="progress-label">Overall</span><span class="progress-pct">${j.completion}%</span></div><div class="progress-track"><div class="progress-fill ${fc}" style="width:${j.completion}%"></div></div></div>
      <div class="job-checklists">${tags}</div>
      <div class="job-meta"><span class="meta-item">ğŸ‘¤ ${j.pm}</span><span class="meta-item">ğŸ’° ${j.value}</span></div>
    </div>`;
  }).join('') || '<div style="text-align:center;padding:40px;color:var(--text3)">No jobs here</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JOB DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderJobDetail() {
  const j = currentJob;
  const totalDone = Object.values(j.checklists).reduce((s,c) => s + c.done, 0);
  const totalAll = Object.values(j.checklists).reduce((s,c) => s + c.total, 0);
  const overallPct = Math.round((totalDone/totalAll)*100);
  const ringCirc = 2 * Math.PI * 50;
  const ringOffset = ringCirc - (overallPct / 100) * ringCirc;
  const ringColor = overallPct > 75 ? 'var(--green)' : overallPct > 40 ? 'var(--blue)' : overallPct > 20 ? 'var(--amber)' : 'var(--red)';

  const sc = j.status === 'active' ? 'status-active' : j.status === 'review' ? 'status-review' : 'status-complete';
  const st = j.status === 'active' ? 'ACTIVE' : j.status === 'review' ? 'NEEDS REVIEW' : 'COMPLETE';

  // Determine current phase
  const phases = [
    { key:'cra', name:'Risk Assessment', pct: Math.round((j.checklists.cra.done/j.checklists.cra.total)*100) },
    { key:'wdc', name:'Workshop Drawings', pct: Math.round((j.checklists.wdc.done/j.checklists.wdc.total)*100) },
    { key:'itp', name:'Inspection & Test', pct: Math.round((j.checklists.itp.done/j.checklists.itp.total)*100) },
    { key:'qa', name:'QA & Handover', pct: Math.round((j.checklists.qa.done/j.checklists.qa.total)*100) }
  ];
  let activePhaseIdx = phases.findIndex(p => p.pct < 100);
  if (activePhaseIdx === -1) activePhaseIdx = 3;

  const clCards = Object.entries(j.checklists).map(([key, cl]) => {
    const meta = CL_META[key];
    const pct = Math.round((cl.done/cl.total)*100);
    const fc = pct === 100 ? 'fill-green' : pct > 50 ? 'fill-blue' : pct > 0 ? 'fill-amber' : 'fill-red';
    let statusCls, statusTxt;
    if (cl.overdue) { statusCls = 'background:var(--red-dim);color:var(--red);border:1px solid var(--red-border)'; statusTxt = 'OVERDUE'; }
    else if (cl.review) { statusCls = 'background:var(--amber-dim);color:var(--amber);border:1px solid var(--amber-border)'; statusTxt = 'IN REVIEW'; }
    else if (pct === 100) { statusCls = 'background:var(--green-dim);color:var(--green);border:1px solid var(--green-border)'; statusTxt = 'COMPLETE'; }
    else if (pct === 0) { statusCls = 'background:var(--surface2);color:var(--text3);border:1px solid var(--border)'; statusTxt = 'NOT STARTED'; }
    else { statusCls = 'background:var(--blue-dim);color:var(--navy);border:1px solid rgba(72,201,245,.3)'; statusTxt = 'IN PROGRESS'; }

    const template = CL_TEMPLATES[key];
    let idx = 0;
    const secTags = template.sections.map(sec => {
      const secStart = idx;
      idx += sec.items.length;
      const secDone = Math.min(cl.done - secStart, sec.items.length);
      const isDone = secDone >= sec.items.length;
      return `<span class="cl-sec-tag ${isDone ? 'done' : ''}">${isDone ? 'âœ“ ' : ''}${sec.title}</span>`;
    }).join('');

    return `<div class="cl-card" onclick="navigate('checklist','${key}')">
      <div class="cl-card-top">
        <div class="cl-card-icon ${meta.iconCls}">${meta.icon}</div>
        <span class="cl-card-status" style="${statusCls}">${statusTxt}</span>
      </div>
      <div class="cl-card-name">${meta.name}</div>
      <div class="cl-card-count">${cl.done} of ${cl.total} items complete</div>
      <div class="cl-card-progress">
        <div class="progress-header"><span class="progress-label">Progress</span><span class="progress-pct">${pct}%</span></div>
        <div class="progress-track"><div class="progress-fill ${fc}" style="width:${pct}%"></div></div>
      </div>
      <div class="cl-card-sections">${secTags}</div>
      <div class="cl-card-arrow">â†’</div>
    </div>`;
  }).join('');

  const activityHtml = (j.activity || []).map(a =>
    `<div class="activity-item"><div class="activity-dot" style="background:${a.dot}"></div><div class="activity-content"><div class="activity-text">${a.text}</div><div class="activity-time">${a.time}</div></div></div>`
  ).join('');

  const notesHtml = (j.notes || []).map(n =>
    `<div class="note-item">${n}<div class="note-meta">Added by ${j.pm}</div></div>`
  ).join('');

  document.getElementById('view-job').innerHTML = `
    <div class="breadcrumb">
      <a onclick="navigate('dashboard')">Dashboard</a>
      <span class="bc-sep">â€º</span>
      <span>${j.name}</span>
    </div>

    <div class="jd-hero">
      <div class="jd-hero-top">
        <div>
          <div class="jd-name">${j.name}</div>
          <div class="jd-client">${j.client} &middot; <span class="job-status ${sc}" style="display:inline-block;vertical-align:middle">${st}</span></div>
        </div>
      </div>
      <div class="jd-hero-meta">
        <div class="jd-meta-item"><div class="jd-meta-label">Project Manager</div><div class="jd-meta-value">${j.pm.split(' ')[0]}</div></div>
        <div class="jd-meta-item"><div class="jd-meta-label">Contract Value</div><div class="jd-meta-value">${j.value}</div></div>
        <div class="jd-meta-item"><div class="jd-meta-label">Start Date</div><div class="jd-meta-value">${new Date(j.start+'T00:00:00').toLocaleDateString('en-AU',{month:'short',day:'numeric',year:'numeric'})}</div></div>
        <div class="jd-meta-item"><div class="jd-meta-label">Items Complete</div><div class="jd-meta-value">${totalDone}/${totalAll}</div></div>
      </div>
    </div>

    <div class="jd-progress-section">
      <div class="jd-ring-wrap">
        <div class="jd-ring">
          <svg width="120" height="120" viewBox="0 0 120 120">
            <circle class="jd-ring-bg" cx="60" cy="60" r="50"/>
            <circle class="jd-ring-fill" cx="60" cy="60" r="50" stroke="${ringColor}" stroke-dasharray="${ringCirc}" stroke-dashoffset="${ringOffset}"/>
          </svg>
          <div class="jd-ring-center">
            <div class="jd-ring-pct">${overallPct}%</div>
            <div class="jd-ring-label">Complete</div>
          </div>
        </div>
      </div>
      <div class="jd-phase-list">
        ${phases.map((p,i) => {
          const dotCls = p.pct === 100 ? 'done' : i === activePhaseIdx ? 'active' : 'pending';
          const rowCls = i === activePhaseIdx ? 'current' : '';
          return `<div class="jd-phase ${rowCls}"><div class="jd-phase-dot ${dotCls}"></div><div class="jd-phase-name">${p.name}</div><div class="jd-phase-pct" style="color:${p.pct===100?'var(--green)':p.pct>0?'var(--blue-light)':'var(--text3)'}">${p.pct}%</div></div>`;
        }).join('')}
      </div>
    </div>

    <div class="section-head"><div class="section-title">Checklists</div></div>
    <div class="cl-cards-grid">${clCards}</div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="jd-activity">
        <div class="jd-activity-title">ğŸ“‹ Activity</div>
        ${activityHtml || '<div style="color:var(--text3);font-size:13px;padding:8px 0">No activity yet</div>'}
      </div>
      <div class="jd-notes">
        <div class="jd-notes-title">ğŸ“ Notes</div>
        ${notesHtml}
        <div style="margin-top:12px">
          <textarea class="jd-note-input" id="note-input" placeholder="Add a note..."></textarea>
          <button class="jd-note-btn" onclick="addNote()">Add Note</button>
        </div>
      </div>
    </div>
  `;

  // Animate ring
  setTimeout(() => {
    const ring = document.querySelector('.jd-ring-fill');
    if (ring) ring.style.strokeDashoffset = ringOffset;
  }, 50);
}

function addNote() {
  const input = document.getElementById('note-input');
  const text = input.value.trim();
  if (!text) return;
  currentJob.notes = currentJob.notes || [];
  currentJob.notes.push(text);
  input.value = '';
  renderJobDetail();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECKLIST DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChecklist() {
  const j = currentJob;
  const key = currentCL;
  const meta = CL_META[key];
  const template = CL_TEMPLATES[key];
  const cl = j.checklists[key];
  let doneCount = cl.done;
  const totalCount = cl.total;
  const pct = Math.round((doneCount/totalCount)*100);
  const fc = pct === 100 ? 'fill-green' : pct > 50 ? 'fill-blue' : pct > 0 ? 'fill-amber' : 'fill-red';

  const riskLevels = ['LOW','MED','HIGH',''];
  const riskClasses = ['risk-green','risk-amber','risk-red','risk-none'];

  let globalIdx = 0;
  const sectionsHtml = template.sections.map((sec, si) => {
    let secDone = 0;
    const itemsHtml = sec.items.map((q, qi) => {
      globalIdx++;
      const isDone = globalIdx <= doneCount;
      if (isDone) secDone++;
      const ri = key === 'cra' ? Math.floor(Math.random()*4) : 3;
      const riskTag = ri < 3 ? `<span class="cli-risk ${riskClasses[ri]}">${riskLevels[ri]}</span>` : '';
      return `<div class="cli ${isDone?'done':''}" onclick="toggleCLI(this)">
        <span class="cli-num">${globalIdx}</span>
        <div class="cli-check"></div>
        <div class="cli-text">${q}</div>
        ${riskTag}
      </div>`;
    }).join('');

    const secPct = Math.round((secDone/sec.items.length)*100);
    const secFc = secPct===100?'fill-green':secPct>50?'fill-blue':secPct>0?'fill-amber':'';

    return `<div class="cl-section${si===0?' open':''}">
      <div class="cl-section-header" onclick="toggleSection(this)">
        <span class="cl-section-chevron">â€º</span>
        <span class="cl-section-name">${sec.title}</span>
        <div class="cl-section-progress">
          <div class="cl-section-bar"><div class="cl-section-bar-fill ${secFc}" style="width:${secPct}%"></div></div>
          <span class="cl-section-pct" style="color:${secPct===100?'var(--green)':secPct>0?'var(--text)':'var(--text3)'}">${secDone}/${sec.items.length}</span>
        </div>
      </div>
      <div class="cl-section-body">${itemsHtml}</div>
    </div>`;
  }).join('');

  const remaining = totalCount - doneCount;

  document.getElementById('view-checklist').innerHTML = `
    <div class="breadcrumb">
      <a onclick="navigate('dashboard')">Dashboard</a>
      <span class="bc-sep">â€º</span>
      <a onclick="navigate('job',${j.id})">${j.name}</a>
      <span class="bc-sep">â€º</span>
      <span>${meta.name}</span>
    </div>

    <div class="cl-sticky">
      <div class="cl-head-row">
        <div class="cl-head-left">
          <div class="cl-head-icon ${meta.iconCls}" style="background:var(--${meta.iconCls==='cra'?'red':meta.iconCls==='wdc'?'blue':meta.iconCls==='itp'?'amber':'green'}-dim)">${meta.icon}</div>
          <div>
            <div class="cl-head-title">${meta.name}</div>
            <div class="cl-head-sub">${j.name} &middot; ${j.client}</div>
          </div>
        </div>
        <div class="cl-head-stats">
          <div class="cl-head-stat"><div class="cl-head-stat-val" style="color:var(--green)">${doneCount}</div><div class="cl-head-stat-label">Done</div></div>
          <div class="cl-head-stat"><div class="cl-head-stat-val" style="color:${remaining>0?'var(--amber)':'var(--green)'}">${remaining}</div><div class="cl-head-stat-label">Remaining</div></div>
          <div class="cl-head-stat"><div class="cl-head-stat-val">${pct}%</div><div class="cl-head-stat-label">Complete</div></div>
        </div>
      </div>
      <div class="cl-big-progress"><div class="progress-fill ${fc}" id="cl-main-bar" style="width:${pct}%"></div></div>
    </div>

    ${sectionsHtml}
  `;
}

function toggleSection(header) {
  header.parentElement.classList.toggle('open');
}

function toggleCLI(el) {
  el.classList.toggle('done');
  updateChecklistProgress();
}

function updateChecklistProgress() {
  const total = document.querySelectorAll('#view-checklist .cli').length;
  const done = document.querySelectorAll('#view-checklist .cli.done').length;
  const pct = Math.round((done/total)*100);
  const fc = pct===100?'fill-green':pct>50?'fill-blue':pct>0?'fill-amber':'fill-red';

  // Update main bar
  const bar = document.getElementById('cl-main-bar');
  if (bar) { bar.style.width = pct+'%'; bar.className = 'progress-fill '+fc; }

  // Update head stats
  const stats = document.querySelectorAll('.cl-head-stat-val');
  if (stats.length >= 3) {
    stats[0].textContent = done;
    stats[1].textContent = total - done;
    stats[2].textContent = pct + '%';
  }

  // Update section bars
  document.querySelectorAll('.cl-section').forEach(sec => {
    const secTotal = sec.querySelectorAll('.cli').length;
    const secDone = sec.querySelectorAll('.cli.done').length;
    const sp = Math.round((secDone/secTotal)*100);
    const sf = sp===100?'fill-green':sp>50?'fill-blue':sp>0?'fill-amber':'';
    const barFill = sec.querySelector('.cl-section-bar-fill');
    if (barFill) { barFill.style.width = sp+'%'; barFill.className = 'cl-section-bar-fill '+sf; }
    const pctEl = sec.querySelector('.cl-section-pct');
    if (pctEl) { pctEl.textContent = secDone+'/'+secTotal; pctEl.style.color = sp===100?'var(--green)':sp>0?'var(--text)':'var(--text3)'; }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openNewJob() { document.getElementById('modal-new-job').classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function createJob() {
  const name = document.getElementById('new-job-name').value;
  if (!name) return;
  JOBS.push({ id:JOBS.length+1, name, client:document.getElementById('new-job-client').value||'TBC', pm:document.getElementById('new-job-pm').value, value:document.getElementById('new-job-value').value||'TBC', status:'active', start:document.getElementById('new-job-date').value||'2026-02-25', completion:0, checklists:{cra:{done:0,total:60},wdc:{done:0,total:120},itp:{done:0,total:85},qa:{done:0,total:65}}, notes:[], activity:[{text:'Job created',dot:'var(--text3)',time:'Just now'}] });
  closeModal('modal-new-job');
  renderJobs('active');
}
document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if (e.target===m) m.classList.remove('open'); }));

// Auto-login on page load
window.addEventListener('DOMContentLoaded', function() {
  navigate('dashboard');
});
</script>
</body>
</html>
